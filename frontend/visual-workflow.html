<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="icon" type="image/x-icon" href="shared/assets/favicon.ico">
    <title data-i18n="visualWorkflow.pageTitle">Visual Workflow Builder - EngiSuite Analytics Pro</title>
    <link rel="stylesheet" href="shared/css/universal-theme.css">
    <link rel="stylesheet" href="shared/css/mobile-responsive.css">
    <link rel="stylesheet" href="shared/css/scrollbar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="shared/js/tailwind-config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            blue: '#2a5298',
                            dark: '#1e3c72',
                            text: '#2c3e50',
                            light: '#f5f7fa',
                            accent: '#3498db',
                            success: '#2ecc71',
                            warning: '#f39c12',
                            danger: '#e74c3c',
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="font-sans antialiased text-brand-text bg-gray-50 h-screen flex overflow-hidden">
    <!-- Sidebar (loaded dynamically) -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0 overflow-hidden bg-gray-50">
        <!-- Header (loaded dynamically) -->
        <div id="header-container"></div>

        <!-- Workflow Container -->
        <div class="flex-1 overflow-hidden flex flex-col">
            <!-- Mobile Component Drawer Toggle -->
            <button id="toggle-components-drawer"
                class="md:hidden fixed bottom-20 right-4 z-40 w-14 h-14 bg-brand-blue text-white rounded-full shadow-lg flex items-center justify-center touch-target">
                <i class="fas fa-cubes"></i>
            </button>

            <!-- Workflow Content -->
            <div class="workflow-container flex-1 flex flex-col md:flex-row">
                <!-- Left Sidebar: Components (Desktop) -->
                <div
                    class="workflow-sidebar hidden md:flex w-64 bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex-col shadow-sm">
                    <div
                        class="workflow-sidebar-header p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50">
                        <h2 class="font-bold text-slate-800 dark:text-slate-100" data-i18n="visualWorkflow.components">
                            Components</h2>
                    </div>
                    <div class="workflow-components flex-1 overflow-y-auto p-4" id="builder-components">
                        <!-- Components will be dynamically populated -->
                    </div>
                </div>

                <!-- Mobile Components Drawer -->
                <div id="mobile-components-drawer" class="fixed inset-0 z-50 hidden md:hidden">
                    <div class="absolute inset-0 bg-black/50" id="components-drawer-overlay"></div>
                    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[70vh] overflow-hidden transform translate-y-full transition-transform duration-300"
                        id="components-drawer-content">
                        <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                            <h2 class="font-bold text-slate-800" data-i18n="visualWorkflow.components">Components</h2>
                            <button id="close-components-drawer"
                                class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 touch-target">
                                <i class="fas fa-times text-slate-500"></i>
                            </button>
                        </div>
                        <div class="p-4 overflow-y-auto max-h-[calc(70vh-60px)]" id="mobile-builder-components">
                            <!-- Components will be dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Main Canvas -->
                <div class="workflow-content flex-1 flex flex-col min-w-0">
                    <div
                        class="workflow-toolbar p-3 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex flex-wrap gap-2 items-center overflow-x-auto">
                        <div class="toolbar-group flex gap-1">
                            <button class="btn btn-primary btn-icon" title="Zoom In">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button class="btn btn-primary btn-icon" title="Zoom Out">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <button class="btn btn-primary btn-icon" title="Reset View">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>

                        <div class="toolbar-group">
                            <button class="btn btn-primary" onclick="VisualWorkflow.saveWorkflow()">
                                <i class="fas fa-save"></i> <span data-i18n="common.save">Save</span>
                            </button>
                            <button class="btn btn-secondary" onclick="VisualWorkflow.loadWorkflow()">
                                <i class="fas fa-folder-open"></i> <span data-i18n="common.load">Load</span>
                            </button>
                            <button class="btn btn-danger" onclick="VisualWorkflow.clearCanvas()">
                                <i class="fas fa-trash"></i> <span data-i18n="common.clear">Clear</span>
                            </button>
                        </div>

                        <div class="toolbar-group">
                            <button class="btn btn-secondary" id="examples-btn">
                                <i class="fas fa-lightbulb"></i> <span
                                    data-i18n="visualWorkflow.examples">Examples</span>
                            </button>
                        </div>

                        <div class="workflow-stats ml-auto text-sm text-slate-500 dark:text-slate-400 px-3">
                            <span id="node-count" data-i18n="visualWorkflow.nodes">0 nodes</span>
                            <span class="mx-2">â€¢</span>
                            <span id="connection-count" data-i18n="visualWorkflow.connections">0 connections</span>
                        </div>
                    </div>

                    <div class="workflow-canvas-container flex-1 bg-slate-50 dark:bg-slate-900/50">
                        <canvas id="visual-canvas" class="w-full h-full"></canvas>
                    </div>
                </div>

                <!-- Right Sidebar: Properties -->
                <div
                    class="workflow-properties hidden lg:flex w-80 bg-white dark:bg-slate-800 border-l border-slate-200 dark:border-slate-700 flex-col shadow-sm">
                    <div
                        class="workflow-properties-header p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50">
                        <h3 class="font-bold text-slate-800 dark:text-slate-100" data-i18n="visualWorkflow.properties">
                            Properties</h3>
                    </div>
                    <div class="workflow-properties-content flex-1 overflow-y-auto p-4" id="builder-props-content">
                        <div class="node-properties text-slate-600 dark:text-slate-300">
                            <p data-i18n="visualWorkflow.selectNode">Select a node to view properties</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Examples Menu -->
            <div class="examples-menu fixed top-20 right-6 w-96 max-w-[calc(100vw-2rem)] bg-white dark:bg-slate-800 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 z-50 hidden"
                id="examples-menu">
                <div
                    class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900 rounded-t-xl border-b border-slate-200 dark:border-slate-700">
                    <h4 class="font-semibold text-slate-800 dark:text-slate-100" data-i18n="visualWorkflow.examples">
                        Workflow Examples</h4>
                    <button
                        class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 transition-colors"
                        id="examples-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <input type="text"
                        class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all"
                        id="examples-search" placeholder="Search examples...">
                </div>
                <div class="max-h-[50vh] overflow-y-auto px-4 pb-4 space-y-4">
                    <div id="examples-featured">
                        <!-- Featured examples will be populated -->
                    </div>
                    <div id="workflows-library">
                        <!-- Workflows library will be populated -->
                    </div>
                    <div id="examples-library">
                        <!-- Examples library will be populated -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="shared/js/theme-manager.js"></script>
        <script src="shared/js/i18n.js"></script>
        <script src="shared/js/auth.js"></script>
        <script src="shared/js/page-init.js"></script>
        <script src="shared/js/utils.js"></script>
        <script src="shared/js/mobile-navigation.js"></script>
        <script src="shared/js/calculators.js"></script>
        <script src="shared/js/visual-workflow.js"></script>
        <script type="module" src="shared/js/visual-workflow-app.js"></script>
</body>

</html>